<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RaiPod æ‰©å±•è°ƒè¯•æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .debug-info {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .error {
            background: #ffe6e6;
            border-left: 4px solid #ff0000;
        }
        .success {
            background: #e6ffe6;
            border-left: 4px solid #00ff00;
        }
        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #005a87;
        }
        .step {
            background: #e7f3ff;
            border-left: 4px solid #007cba;
            padding: 10px;
            margin: 10px 0;
        }
        code {
            background: #f4f4f4;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <h1>RaiPod æ‰©å±•è°ƒè¯•æµ‹è¯•é¡µé¢</h1>
    
    <div class="debug-info error">
        <h3>ğŸš¨ å½“å‰é—®é¢˜ï¼šService Workerè¿æ¥é”™è¯¯</h3>
        <p><strong>é”™è¯¯ä¿¡æ¯ï¼š</strong>"Could not establish connection. Receiving end does not exist."</p>
        <p><strong>æ ¹æœ¬åŸå› ï¼š</strong>Content Scriptæœªæ­£ç¡®æ³¨å…¥åˆ°é¡µé¢ä¸­ï¼Œå¯¼è‡´Background Service Workeræ— æ³•ä¸é¡µé¢é€šä¿¡ã€‚</p>
    </div>

    <div class="debug-info warning">
        <h3>âš ï¸ è§£å†³æ–¹æ¡ˆæ¦‚è¿°</h3>
        <p>æˆ‘å·²ç»å®æ–½äº†ä»¥ä¸‹ä¿®å¤æªæ–½ï¼š</p>
        <ul>
            <li>åœ¨manifest.jsonä¸­æ·»åŠ äº†<code>run_at: "document_end"</code>é…ç½®</li>
            <li>åœ¨Service Workerä¸­æ·»åŠ äº†Content Scriptæ£€æµ‹å’Œè‡ªåŠ¨æ³¨å…¥æœºåˆ¶</li>
            <li>å¢å¼ºäº†é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•</li>
        </ul>
    </div>

    <div class="step">
        <h3>ğŸ“‹ è¯¦ç»†è°ƒè¯•æ­¥éª¤</h3>
        
        <h4>æ­¥éª¤1ï¼šé‡æ–°åŠ è½½æ‰©å±•</h4>
        <ol>
            <li>æ‰“å¼€Chromeæ‰©å±•ç®¡ç†é¡µé¢ï¼š<code>chrome://extensions/</code></li>
            <li>æ‰¾åˆ°RaiPodæ‰©å±•</li>
            <li>ç‚¹å‡»"é‡æ–°åŠ è½½"æŒ‰é’®ï¼ˆğŸ”„å›¾æ ‡ï¼‰</li>
            <li>ç¡®è®¤æ‰©å±•çŠ¶æ€ä¸º"å·²å¯ç”¨"</li>
        </ol>

        <h4>æ­¥éª¤2ï¼šæ£€æŸ¥Service WorkerçŠ¶æ€</h4>
        <ol>
            <li>åœ¨æ‰©å±•ç®¡ç†é¡µé¢ï¼Œç‚¹å‡»RaiPodæ‰©å±•çš„"è¯¦ç»†ä¿¡æ¯"</li>
            <li>ç‚¹å‡»"æ£€æŸ¥è§†å›¾ï¼šservice worker"</li>
            <li>æŸ¥çœ‹Consoleä¸­æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯</li>
            <li>å¦‚æœService Workeræ˜¾ç¤º"éæ´»åŠ¨"ï¼Œç‚¹å‡»ä¸€ä¸‹æ‰©å±•å›¾æ ‡æ¿€æ´»å®ƒ</li>
        </ol>

        <h4>æ­¥éª¤3ï¼šæµ‹è¯•æ‰©å±•åŠŸèƒ½</h4>
        <ol>
            <li>åœ¨å½“å‰é¡µé¢æ‰“å¼€Chromeå¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰</li>
            <li>åˆ‡æ¢åˆ°Consoleæ ‡ç­¾é¡µ</li>
            <li>ç‚¹å‡»æ‰©å±•å›¾æ ‡æ‰“å¼€popup</li>
            <li>è§‚å¯ŸConsoleä¸­çš„æ—¥å¿—ä¿¡æ¯</li>
        </ol>
    </div>

    <div class="debug-info">
        <h3>ğŸ”§ æ‰‹åŠ¨æµ‹è¯•å·¥å…·</h3>
        <button onclick="testExtensionAPI()">æµ‹è¯•æ‰©å±•API</button>
        <button onclick="testContentScript()">æµ‹è¯•Content Script</button>
        <button onclick="testConsoleLog()">è¾“å‡ºè°ƒè¯•ä¿¡æ¯</button>
        <button onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
        <div id="test-results"></div>
    </div>

    <h2>æµ‹è¯•å†…å®¹ï¼šäººå·¥æ™ºèƒ½ä¸æ’­å®¢æŠ€æœ¯</h2>
    <p>äººå·¥æ™ºèƒ½ï¼ˆAIï¼‰æ­£åœ¨é©å‘½æ€§åœ°æ”¹å˜æˆ‘ä»¬åˆ›å»ºå’Œæ¶ˆè´¹å†…å®¹çš„æ–¹å¼ã€‚åœ¨æ’­å®¢é¢†åŸŸï¼ŒAIæŠ€æœ¯ä½¿å¾—è‡ªåŠ¨åŒ–å†…å®¹ç”Ÿæˆã€è¯­éŸ³åˆæˆå’Œä¸ªæ€§åŒ–æ¨èæˆä¸ºå¯èƒ½ã€‚</p>
    
    <h3>AIæ’­å®¢ç”Ÿæˆçš„ä¼˜åŠ¿</h3>
    <ul>
        <li><strong>æ•ˆç‡æå‡ï¼š</strong>è‡ªåŠ¨åŒ–å†…å®¹åˆ›å»ºè¿‡ç¨‹ï¼ŒèŠ‚çœå¤§é‡æ—¶é—´å’ŒäººåŠ›æˆæœ¬</li>
        <li><strong>ä¸ªæ€§åŒ–ä½“éªŒï¼š</strong>æ ¹æ®ç”¨æˆ·åå¥½å®šåˆ¶å†…å®¹å’Œæ’­æ”¾ä½“éªŒ</li>
        <li><strong>å¤šè¯­è¨€æ”¯æŒï¼š</strong>è½»æ¾ç”Ÿæˆå¤šç§è¯­è¨€ç‰ˆæœ¬çš„æ’­å®¢å†…å®¹</li>
        <li><strong>ä¸€è‡´æ€§ä¿è¯ï¼š</strong>ç¡®ä¿å†…å®¹è´¨é‡å’Œé£æ ¼çš„ç»Ÿä¸€æ€§</li>
    </ul>

    <h3>æŠ€æœ¯å®ç°æ¶æ„</h3>
    <p>ç°ä»£AIæ’­å®¢ç”Ÿæˆç³»ç»Ÿé€šå¸¸åŒ…å«ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶ï¼š</p>
    <ol>
        <li><strong>å†…å®¹æå–æ¨¡å—ï¼š</strong>ä»ç½‘é¡µæˆ–æ–‡æ¡£ä¸­æ™ºèƒ½æå–å…³é”®ä¿¡æ¯</li>
        <li><strong>è„šæœ¬ç”Ÿæˆå¼•æ“ï¼š</strong>ä½¿ç”¨å¤§è¯­è¨€æ¨¡å‹åˆ›å»ºå¯¹è¯å¼æ’­å®¢è„šæœ¬</li>
        <li><strong>è¯­éŸ³åˆæˆç³»ç»Ÿï¼š</strong>å°†æ–‡æœ¬è½¬æ¢ä¸ºè‡ªç„¶æµç•…çš„è¯­éŸ³</li>
        <li><strong>åæœŸå¤„ç†å·¥å…·ï¼š</strong>æ·»åŠ èƒŒæ™¯éŸ³ä¹ã€éŸ³æ•ˆå’Œæ ¼å¼ä¼˜åŒ–</li>
    </ol>

    <div class="debug-info">
        <h2>ğŸ”§ å·²å®æ–½çš„ä¿®å¤æªæ–½</h2>

        <h3>1. Content Script æ³¨å…¥ä¼˜åŒ–</h3>
        <ul>
            <li>âœ… åœ¨ <code>manifest.json</code> ä¸­æ·»åŠ äº† <code>"run_at": "document_end"</code> é…ç½®</li>
            <li>âœ… è®¾ç½® <code>"all_frames": false</code> ç¡®ä¿åªåœ¨ä¸»æ¡†æ¶è¿è¡Œ</li>
            <li>âœ… ä¿æŒ <code>"matches": ["&lt;all_urls&gt;"]</code> æ”¯æŒæ‰€æœ‰é¡µé¢</li>
            <li>âœ… <strong>æ–°å¢</strong>: æ·»åŠ å…¨å±€æ ‡è¯†ç¬¦ <code>RaiPodContentScriptLoaded</code> ç”¨äºæ£€æµ‹</li>
            <li>âœ… <strong>æ–°å¢</strong>: é˜²æ­¢é‡å¤å®ä¾‹åŒ–çš„ä¿æŠ¤æœºåˆ¶</li>
        </ul>

        <h3>2. Service Worker é€šä¿¡æœºåˆ¶å¢å¼º</h3>
        <ul>
            <li>âœ… æ·»åŠ äº†æ™ºèƒ½æ£€æµ‹ Content Script æ˜¯å¦å·²æ³¨å…¥çš„é€»è¾‘</li>
            <li>âœ… å®ç°è‡ªåŠ¨æ³¨å…¥ Content Script çš„å¤‡ç”¨æœºåˆ¶</li>
            <li>âœ… ä¼˜åŒ–äº†é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ</li>
            <li>âœ… å¢åŠ äº†é€‚å½“çš„ç­‰å¾…æ—¶é—´ç¡®ä¿åˆå§‹åŒ–å®Œæˆ</li>
            <li>âœ… <strong>æ–°å¢</strong>: ä½¿ç”¨å…¨å±€æ ‡è¯†ç¬¦è¿›è¡Œæ›´å¯é çš„æ£€æµ‹</li>
            <li>âœ… <strong>æ–°å¢</strong>: æ·»åŠ  <code>CONTENT_SCRIPT_READY</code> æ¶ˆæ¯å¤„ç†</li>
        </ul>

        <h3>3. è°ƒè¯•å·¥å…·å®Œå–„</h3>
        <ul>
            <li>âœ… æä¾›è¯¦ç»†çš„è°ƒè¯•æ­¥éª¤å’Œæ£€æŸ¥æ¸…å•</li>
            <li>âœ… æ·»åŠ æ‰‹åŠ¨æµ‹è¯•å·¥å…·</li>
            <li>âœ… åŒ…å«å¸¸è§é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ</li>
            <li>âœ… <strong>æ–°å¢</strong>: æ›´è¯¦ç»†çš„é”™è¯¯è¯Šæ–­ä¿¡æ¯</li>
        </ul>
    </div>

    <div class="debug-info success">
        <h3>âœ… é¢„æœŸä¿®å¤æ•ˆæœ</h3>
        <p>ä¿®å¤åï¼Œæ‰©å±•åº”è¯¥èƒ½å¤Ÿï¼š</p>
        <ul>
            <li>æ­£ç¡®æ£€æµ‹å’Œæ³¨å…¥Content Script</li>
            <li>æˆåŠŸå»ºç«‹Service Workerä¸é¡µé¢çš„é€šä¿¡</li>
            <li>æå–å½“å‰é¡µé¢çš„æ ‡é¢˜å’Œå†…å®¹</li>
            <li>åœ¨popupä¸­æ˜¾ç¤ºé¡µé¢ä¿¡æ¯</li>
            <li>æä¾›ç”Ÿæˆæ’­å®¢çš„åŠŸèƒ½é€‰é¡¹</li>
        </ul>
        
        <h3>âœ… é¢„æœŸæ•ˆæœ</h3>
        <ul>
            <li>âœ… æ¶ˆé™¤ "Could not establish connection" é”™è¯¯</li>
            <li>âœ… Content Script åœ¨æ‰€æœ‰æ”¯æŒçš„é¡µé¢æ­£ç¡®æ³¨å…¥</li>
            <li>âœ… Service Worker ä¸ Content Script é€šä¿¡ç¨³å®š</li>
            <li>âœ… <strong>æ–°å¢</strong>: ä¿®å¤ Popup "æ— æ³•è¿æ¥åˆ°åå°æœåŠ¡" é”™è¯¯</li>
            <li>âœ… <strong>æ–°å¢</strong>: ä¼˜åŒ–å¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶</li>
            <li>âœ… æä¾›æ¸…æ™°çš„é”™è¯¯åé¦ˆå’Œè°ƒè¯•ä¿¡æ¯</li>
        </ul>
    </div>

    <script>
        function testExtensionAPI() {
            const results = document.getElementById('test-results');
            results.innerHTML = '<div class="debug-info">æ­£åœ¨æµ‹è¯•æ‰©å±•API...</div>';
            
            if (window.chrome && window.chrome.runtime) {
                results.innerHTML = '<div class="debug-info success">âœ“ Chromeæ‰©å±•APIå¯ç”¨</div>';
                
                // æµ‹è¯•ä¸backgroundçš„é€šä¿¡
                try {
                    chrome.runtime.sendMessage({type: 'TEST_CONNECTION'}, (response) => {
                        if (chrome.runtime.lastError) {
                            results.innerHTML += '<div class="debug-info error">âœ— ä¸Backgroundé€šä¿¡å¤±è´¥: ' + chrome.runtime.lastError.message + '</div>';
                        } else {
                            results.innerHTML += '<div class="debug-info success">âœ“ ä¸Backgroundé€šä¿¡æ­£å¸¸</div>';
                        }
                    });
                } catch (error) {
                    results.innerHTML += '<div class="debug-info error">âœ— å‘é€æ¶ˆæ¯å¼‚å¸¸: ' + error.message + '</div>';
                }
            } else {
                results.innerHTML = '<div class="debug-info error">âœ— Chromeæ‰©å±•APIä¸å¯ç”¨</div>';
            }
        }
        
        function testContentScript() {
            const results = document.getElementById('test-results');
            results.innerHTML = '<div class="debug-info">æ­£åœ¨æ£€æŸ¥Content ScriptçŠ¶æ€...</div>';
            
            // æ£€æŸ¥æ˜¯å¦æœ‰RaiPodç›¸å…³çš„å…¨å±€å˜é‡æˆ–æ ‡è¯†
            const hasContentScript = document.querySelector('script[src*="content-script"]') || 
                                    window.RaiPodContentScript || 
                                    (console.log('RaiPod Content Script å·²åŠ è½½') && false);
            
            if (hasContentScript) {
                results.innerHTML = '<div class="debug-info success">âœ“ Content Scriptå¯èƒ½å·²åŠ è½½</div>';
            } else {
                results.innerHTML = '<div class="debug-info warning">âš  Content ScriptçŠ¶æ€æœªçŸ¥ï¼Œè¯·æŸ¥çœ‹Consoleæ—¥å¿—</div>';
            }
        }
        
        function testConsoleLog() {
            console.log('=== RaiPodè°ƒè¯•ä¿¡æ¯ ===');
            console.log('é¡µé¢URL:', window.location.href);
            console.log('é¡µé¢æ ‡é¢˜:', document.title);
            console.log('Chromeæ‰©å±•API:', !!window.chrome?.runtime);
            console.log('å½“å‰æ—¶é—´:', new Date().toLocaleString());
            console.log('ç”¨æˆ·ä»£ç†:', navigator.userAgent);
            
            const results = document.getElementById('test-results');
            results.innerHTML = '<div class="debug-info success">âœ“ è°ƒè¯•ä¿¡æ¯å·²è¾“å‡ºåˆ°Consoleï¼Œè¯·æŸ¥çœ‹å¼€å‘è€…å·¥å…·</div>';
        }
        
        function clearResults() {
            document.getElementById('test-results').innerHTML = '';
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('RaiPodè°ƒè¯•é¡µé¢å·²åŠ è½½');
            console.log('è¯·æŒ‰ç…§é¡µé¢ä¸Šçš„æ­¥éª¤è¿›è¡Œè°ƒè¯•');
            
            // è‡ªåŠ¨æ£€æµ‹æ‰©å±•çŠ¶æ€
            setTimeout(() => {
                if (window.chrome && window.chrome.runtime) {
                    console.log('âœ“ Chromeæ‰©å±•ç¯å¢ƒæ£€æµ‹æ­£å¸¸');
                } else {
                    console.warn('âš  Chromeæ‰©å±•ç¯å¢ƒæ£€æµ‹å¼‚å¸¸');
                }
            }, 1000);
        });
    </script>
</body>
</html>